@page "/administration/hangfire"

@inject IJSRuntime JS

<iframe src=@HangFireUrl style="width: 100%; height: 900px;"></iframe>

<script>
    window.onload = function () {
        var iframeElement = document.querySelectorAll("iframe")[0];
        iframeElement.onload = function () {
            RemoveBackToAppLink(100, 10);
        };
    };

    function RemoveBackToAppLink(numTries, delay) {
        var iframeElement = document.querySelectorAll("iframe")[0];
        var counter = 0;
        var loopInterval = setInterval(() =>
        {
            if (counter >= numTries)
                clearInterval(loopInterval);

            var elementToRemove = iframeElement.contentWindow.document.querySelectorAll(".navbar-right")[0];
            if (elementToRemove != null)
            {
                elementToRemove.remove();
                clearInterval(loopInterval);
            }

            counter++;
        }, delay);
    }
</script>

@code {
    private string HangFireUrl { get; set; } = string.Empty;

    protected override void OnInitialized()
    {
        try
        {
            HangFireUrl = NavigationManager.BaseUri + "hangfire";
        }
        catch (Exception ex)
        {
            LoggerFactory.CreateLogger(this.GetType()).LogError(ex, ex.Message);
        }
    }

    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
        try
        {
            await JS.InvokeVoidAsync("RemoveBackToAppLink", 100, 10);
        }
        catch (Exception ex)
        {
            LoggerFactory.CreateLogger(this.GetType()).LogError(ex, ex.Message);
        }

        await base.OnAfterRenderAsync(firstRender);
    }
}